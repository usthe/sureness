"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[8255],{4137:(e,t,a)=>{a.d(t,{Zo:()=>l,kt:()=>h});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var c=n.createContext({}),u=function(e){var t=n.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},l=function(e){var t=u(e.components);return n.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),p=u(a),h=r,m=p["".concat(c,".").concat(h)]||p[h]||d[h]||o;return a?n.createElement(m,i(i({ref:t},l),{},{components:a})):n.createElement(m,i({ref:t},l))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=p;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var u=2;u<o;u++)i[u]=a[u];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}p.displayName="MDXCreateElement"},9177:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>u});var n=a(7462),r=(a(7294),a(4137));const o={id:"annotation-datasource",title:"Annotation Auth DataSource",sidebar_label:"Annotation Datasource"},i=void 0,s={unversionedId:"start/annotation-datasource",id:"start/annotation-datasource",title:"Annotation Auth DataSource",description:"Sureness need dataSource to authenticate and authorize, eg: role data, user data etc.",source:"@site/docs/start/annotation-datasource.md",sourceDirName:"start",slug:"/start/annotation-datasource",permalink:"/sureness/docs/start/annotation-datasource",draft:!1,editUrl:"https://github.com/dromara/sureness/edit/master/home/docs/start/annotation-datasource.md",tags:[],version:"current",frontMatter:{id:"annotation-datasource",title:"Annotation Auth DataSource",sidebar_label:"Annotation Datasource"}},c={},u=[],l={toc:u};function d(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},l,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Sureness need dataSource to authenticate and authorize, eg: role data, user data etc.",(0,r.kt)("br",{parentName:"p"}),"\n","The dataSource can load from txt, dataBase, no dataBase or annotation etc.",(0,r.kt)("br",{parentName:"p"}),"\n","We provide interfaces ",(0,r.kt)("inlineCode",{parentName:"p"},"SurenessAccountProvider"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"PathTreeProvider")," for user implement to load data from the dataSource where they want.",(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("inlineCode",{parentName:"p"},"SurenessAccountProvider")," - Account datasource provider interface.",(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("inlineCode",{parentName:"p"},"PathTreeProvider")," - Resource uri-role datasource provider interface.  "),(0,r.kt)("p",null,"The way of ",(0,r.kt)("inlineCode",{parentName:"p"},"sureness")," to implement the annotation dataSource is not to judge the aop before calling the method,\nbut to scan the data in the annotation as the auth dataSource when startup,\nwhich facilitates the unification of the process and the independence of the framework.    "),(0,r.kt)("p",null,"Here is an introduction to show how to use annotation config auth data."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"First of all, we need to configure the annotation dataSource as the auth dataSource in the sureness startup configuration.  ")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'@Bean\nTreePathRoleMatcher pathRoleMatcher() {\n    // Instantiate the resource permission path matcher, which will match the required role information \n    // according to the requested path and existing resource permission data.\n    DefaultPathRoleMatcher pathRoleMatcher = new DefaultPathRoleMatcher();\n    // Instantiate the resource permission data loader - `AnnotationLoader`, \n    // which implements the PathTreeProvider interface.    \n    AnnotationPathTreeProvider pathTreeProvider = new AnnotationPathTreeProvider();\n    // Set the package path to be scanned by AnnotationLoader, which will scan the \n    // @RequiresRoles, @WithoutAuth annotations on all class methods under the package path to obtain data.\n    pathTreeProvider.setScanPackages(Arrays.asList("com.usthe.sureness.sample.tom.controller"));\n    // Set the AnnotationLoader dataSource as the sureness auth dataSource. \n    pathRoleMatcher.addPathTreeProvider(pathTreeProvider);\n    pathRoleMatcher.buildTree();\n    return pathRoleMatcher;\n}\n')),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Use annotations in the provided interface methods, eg:  ")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'@RequiresRoles(roles = {"role1", "role2"}, mapping = "/resource", method = "post")  \nMeans that the resource /resource===post requires role role1 or role2 to access\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'@WithoutAuth(mapping = "/resource/*", method = "put")  \nMeans that the resource /resource/*===put can be accessed by any request\n')),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Suggest",(0,r.kt)("br",{parentName:"li"}),"Although the annotation auth data is more convenient for us to develop, it is hard-coded in the code and cannot\ndynamically modify the permission role configuration data. It is not very suitable for large projects.",(0,r.kt)("br",{parentName:"li"}),(0,r.kt)("inlineCode",{parentName:"li"},"sureness")," provides the function of loading multiple data sources at the same time, that is,\nwe can simultaneously use the annotation dataSource and database auth dataSource in the sureness configuration.",(0,r.kt)("br",{parentName:"li"}),"For the permission configuration that is not frequently modified, we can configure it to annotations,\nand for other permission data that needs to be dynamically modified, we configure it in the database.")))}d.isMDXComponent=!0}}]);