<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://usthe.com/sureness/zh-cn/blog</id>
    <title>Sureness Blog</title>
    <updated>2021-06-06T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://usthe.com/sureness/zh-cn/blog"/>
    <subtitle>Sureness Blog</subtitle>
    <icon>https://usthe.com/sureness/zh-cn/https://cdn.jsdelivr.net/gh/usthe/sureness@gh-pages/img/icon64.png</icon>
    <rights>Copyright © 2023 USTHE, Inc.</rights>
    <entry>
        <title type="html"><![CDATA[使用Sureness一步一步搭建一个完整认证鉴权项目]]></title>
        <id>/2021/06/06/step-by-step</id>
        <link href="https://usthe.com/sureness/zh-cn/blog/2021/06/06/step-by-step"/>
        <updated>2021-06-06T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[下面我们来一步一步基于springboot,sureness搭建一个如下功能的认证鉴权系统。]]></summary>
        <content type="html"><![CDATA[<p>下面我们来一步一步基于springboot,sureness搭建一个如下功能的认证鉴权系统。  </p><ol><li>使用了配置文件来作为系统的账户数据和权限数据的数据源。   </li><li>系统基于rbac权限模型，支持basic认证，digest认证，jwt认证。  </li><li>能细粒度的控制用户对系统提供的restful api的访问权限，即哪些用户能访问哪些api。  </li></ol><p>多说无益，快速开始！  </p><p>这里为了照顾到刚入门的同学，图文展示了每一步操作。有基础可直接略过。  </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="初始化一个springboot-web工程">初始化一个springboot web工程<a class="hash-link" href="#初始化一个springboot-web工程" title="Direct link to heading">​</a></h3><p>在IDEA如下操作:  </p><p><img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c2bc0a723ea74c86a75952cc486367cb~tplv-k3u1fbpfcp-zoom-1.image" alt="image" class="img_ev3q"></p><p><img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/00d3cd3a015b4a079c0b30da064139d0~tplv-k3u1fbpfcp-zoom-1.image" alt="image" class="img_ev3q"></p><p><img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3be963ed9c28493d9ddc3b48caab54af~tplv-k3u1fbpfcp-zoom-1.image" alt="image" class="img_ev3q"></p><p><img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2bcce3d56cb244b6967914a5b9b807c5~tplv-k3u1fbpfcp-zoom-1.image" alt="image" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="提供一些模拟的restful-api">提供一些模拟的restful api<a class="hash-link" href="#提供一些模拟的restful-api" title="Direct link to heading">​</a></h3><p>新建一个controller, 在里面实现一些简单的restful api供外部测试调用  </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * simulate api controller, for testing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author tomsun28</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @date 17:35 2019-05-12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RestController</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SimulateController {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** access success message **/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static final String SUCCESS_ACCESS_RESOURCE = "access this resource success";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @GetMapping("/api/v1/source1")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ResponseEntity&lt;String&gt; api1Mock1() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return ResponseEntity.ok(SUCCESS_ACCESS_RESOURCE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @PutMapping("/api/v1/source1")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ResponseEntity&lt;String&gt; api1Mock3() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return ResponseEntity.ok(SUCCESS_ACCESS_RESOURCE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @DeleteMapping("/api/v1/source1")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ResponseEntity&lt;String&gt; api1Mock4() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return ResponseEntity.ok(SUCCESS_ACCESS_RESOURCE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @GetMapping("/api/v1/source2")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ResponseEntity&lt;String&gt; api1Mock5() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return ResponseEntity.ok(SUCCESS_ACCESS_RESOURCE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @GetMapping("/api/v1/source2/{var1}/{var2}")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ResponseEntity&lt;String&gt; api1Mock6(@PathVariable String var1, @PathVariable Integer var2 ) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return ResponseEntity.ok(SUCCESS_ACCESS_RESOURCE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @PostMapping("/api/v2/source3/{var1}")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ResponseEntity&lt;String&gt; api1Mock7(@PathVariable String var1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return ResponseEntity.ok(SUCCESS_ACCESS_RESOURCE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @GetMapping("/api/v1/source3")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ResponseEntity&lt;String&gt; api1Mock11(HttpServletRequest request) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return ResponseEntity.ok(SUCCESS_ACCESS_RESOURCE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @GetMapping("/api/v2/source2")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ResponseEntity&lt;String&gt; api1Mock12() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return ResponseEntity.ok(SUCCESS_ACCESS_RESOURCE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="项目中加入sureness依赖">项目中加入sureness依赖<a class="hash-link" href="#项目中加入sureness依赖" title="Direct link to heading">​</a></h3><p>在项目的pom.xml加入sureness的maven依赖坐标    </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;groupId&gt;com.usthe.sureness&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;artifactId&gt;sureness-core&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;version&gt;1.0.3&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如下：  </p><p><img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1c0df60e4bae4d4b80c0209f461fc8b5~tplv-k3u1fbpfcp-zoom-1.image" alt="image" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用默认配置来配置sureness">使用默认配置来配置sureness<a class="hash-link" href="#使用默认配置来配置sureness" title="Direct link to heading">​</a></h3><p>新建一个配置类，创建对应的sureness默认配置bean<br>
<!-- -->sureness默认配置使用了文件数据源<code>sureness.yml</code>作为账户权限数据源<br>
<!-- -->默认配置支持了<code>jwt, basic auth, digest auth</code>认证  </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SurenessConfiguration {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * sureness default config bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return default config bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DefaultSurenessConfig surenessConfig() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new DefaultSurenessConfig();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置默认文本配置数据源">配置默认文本配置数据源<a class="hash-link" href="#配置默认文本配置数据源" title="Direct link to heading">​</a></h3><p>认证鉴权当然也需要我们自己的配置数据:账户数据，角色权限数据等<br>
<!-- -->这些配置数据可能来自文本，关系数据库，非关系数据库<br>
<!-- -->我们这里使用默认的文本形式配置 - sureness.yml, 在resource资源目录下创建sureness.yml文件<br>
<!-- -->在sureness.yml文件里配置我们的角色权限数据和账户数据，如下：  </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## -- sureness.yml文本数据源 -- ##</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 加载到匹配字典的资源,也就是需要被保护的,设置了所支持角色访问的资源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 没有配置的资源也默认被认证保护,但不鉴权，例如/api/v1/source2===get</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># eg: /api/v1/source1===get===[role2] 表示 /api/v1/source1===get 这条资源支持 role2这一种角色访问</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># eg: /api/v2/source2===get===[] 表示 /api/v1/source2===get 这条资源不支持任何角色访问</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resourceRole:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - /api/v1/source1===get===[role2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - /api/v1/source1===delete===[role3]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - /api/v1/source1===put===[role1,role2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - /api/v2/source2===get===[]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - /api/v1/source2/*/*===get===[role2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - /api/v2/source3/*===get===[role2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 需要被过滤保护的资源,不认证鉴权直接访问</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># /api/v1/source3===get 表示 /api/v1/source3===get 可以被任何人访问 无需登录认证鉴权</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">excludedResource:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - /api/v1/account/auth===post</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - /api/v1/source3===get</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - /**/*.html===get</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - /**/*.js===get</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - /**/*.css===get</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - /**/*.ico===get</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 用户账户信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 下面有 admin root tom三个账户</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># eg: admin 拥有[role1,role2]角色,明文密码为admin,加盐密码为0192023A7BBD73250516F069DF18B500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># eg: root 拥有[role1],密码为明文23456</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># eg: tom 拥有[role3],密码为明文32113</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">account:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - appId: admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 如果填写了加密盐--salt,则credential为MD5(password+salt)的32位结果</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 没有盐认为不加密,credential为明文</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 若密码加盐 则digest认证不支持  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    credential: 0192023A7BBD73250516F069DF18B500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    salt: 123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    role: [role1,role2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - appId: root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    credential: 23456</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    role: [role1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - appId: tom</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    credential: 32113</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    role: [role3]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="添加过滤器拦截所有请求对所有请求进行认证鉴权">添加过滤器拦截所有请求,对所有请求进行认证鉴权<a class="hash-link" href="#添加过滤器拦截所有请求对所有请求进行认证鉴权" title="Direct link to heading">​</a></h3><p>新建一个filter, 拦截所有请求，用sureness对所有请求进行认证鉴权。认证鉴权失败的请求sureness会抛出对应的异常，我们捕获响应的异常进行处理返回response即可。  </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Order(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@WebFilter(filterName = "SurenessFilterExample", urlPatterns = "/*", asyncSupported = true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SurenessFilterExample implements Filter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void init(FilterConfig filterConfig) {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void destroy() {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throws IOException, ServletException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            SubjectSum subject = SurenessSecurityManager.getInstance().checkIn(servletRequest);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 认证鉴权成功则会返回带用户信息的subject 可以将subject信息绑定到当前线程上下文holder供后面使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (subject != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                SurenessContextHolder.bindSubject(subject);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (ProcessorNotFoundException | UnknownAccountException | UnsupportedSubjectException e4) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 账户创建相关异常</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            responseWrite(ResponseEntity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .status(HttpStatus.BAD_REQUEST).body(e4.getMessage()), servletResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (DisabledAccountException | ExcessiveAttemptsException e2 ) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 账户禁用相关异常</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            responseWrite(ResponseEntity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .status(HttpStatus.UNAUTHORIZED).body(e2.getMessage()), servletResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (IncorrectCredentialsException | ExpiredCredentialsException e3) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 认证失败相关异常</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            responseWrite(ResponseEntity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .status(HttpStatus.UNAUTHORIZED).body(e3.getMessage()), servletResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (NeedDigestInfoException e5) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // digest认证需要重试异常</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            responseWrite(ResponseEntity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .status(HttpStatus.UNAUTHORIZED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .header("WWW-Authenticate", e5.getAuthenticate()).build(), servletResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (UnauthorizedException e6) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 鉴权失败相关异常，即无权访问此api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            responseWrite(ResponseEntity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .status(HttpStatus.FORBIDDEN).body(e6.getMessage()), servletResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (RuntimeException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 其他异常</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            responseWrite(ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    servletResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 若未抛出异常 则认证鉴权成功 继续下面请求流程</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            filterChain.doFilter(servletRequest, servletResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } finally {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            SurenessContextHolder.clear();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * write response json data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param content content</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param response response</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static void responseWrite(ResponseEntity content, ServletResponse response) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        response.setCharacterEncoding("UTF-8");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        response.setContentType("application/json;charset=utf-8");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ((HttpServletResponse)response).setStatus(content.getStatusCodeValue());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        content.getHeaders().forEach((key, value) -&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ((HttpServletResponse) response).addHeader(key, value.get(0)));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try (PrintWriter printWriter = response.getWriter()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (content.getBody() != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (content.getBody() instanceof String) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    printWriter.write(content.getBody().toString());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ObjectMapper objectMapper = new ObjectMapper();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    printWriter.write(objectMapper.writeValueAsString(content.getBody()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                printWriter.flush();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (IOException e) {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>像上面一样，</p><ol><li>若认证鉴权成功,<code>checkIn</code>会返回包含用户信息的<code>SubjectSum</code>对象  </li><li>若中间认证鉴权失败，<code>checkIn</code>会抛出不同类型的认证鉴权异常,用户需根据这些异常来继续后面的流程(返回相应的请求响应)</li></ol><p>为了使filter在springboot生效 需要在boot启动类加注解 <code>@ServletComponentScan</code>   </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ServletComponentScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class BootstrapApplication {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SpringApplication.run(BootstrapApplication.class, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="一切完毕验证测试">一切完毕，验证测试<a class="hash-link" href="#一切完毕验证测试" title="Direct link to heading">​</a></h3><p>通过上面的步骤 我们的一个完整功能认证鉴权项目就搭建完成了，有同学想 就这几步骤 它的完整功能体现在哪里啊 能支持啥。  </p><p>这个搭好的认证鉴权项目基于rbac权限模型，支持 baisc 认证，digest认证, jwt认证。能细粒度的控制用户对后台提供的restful api的访问权限，即哪些用户能访问哪些api。 我们这里来测试一下。 </p><p>IDEA上启动工程项目。  </p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="basic认证测试">basic认证测试<a class="hash-link" href="#basic认证测试" title="Direct link to heading">​</a></h5><p>资源api/v1/source2===get没有配置到文本数据源里，代表所有角色或无角色都可以访问 前提是认证成功，用该资源来做认证测试</p><p><strong>认证成功</strong>：  </p><p><img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a09f6caa4ef845adb9f5b5fa6e86040b~tplv-k3u1fbpfcp-zoom-1.image" alt="image" class="img_ev3q"></p><p><strong>密码错误</strong>：  </p><p><img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/caa656a9a9174df6afc8768dc859ecb6~tplv-k3u1fbpfcp-zoom-1.image" alt="image" class="img_ev3q"></p><p><strong>账户不存在</strong>：  </p><p><img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/37d8c0d0cd144b4fb8cfd5e0a47e6961~tplv-k3u1fbpfcp-zoom-1.image" alt="image" class="img_ev3q"></p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="digest认证测试">digest认证测试<a class="hash-link" href="#digest认证测试" title="Direct link to heading">​</a></h5><p><strong>注意如果密码配置了加密盐，则无法使用digest认证</strong>  </p><p><img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/53fe5e08301c4171b31b6180a77b5837~tplv-k3u1fbpfcp-zoom-1.image" alt="image" class="img_ev3q"></p><p><img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c12598db019549efa5f990c0136e7582~tplv-k3u1fbpfcp-zoom-1.image" alt="image" class="img_ev3q"></p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="jwt认证测试">jwt认证测试<a class="hash-link" href="#jwt认证测试" title="Direct link to heading">​</a></h5><p>jwt认证首先你得拥有一个签发的jwt，创建如下api接口提供jwt签发- <code>/api/v1/account/auth</code>  </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@RestController()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AccountController {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final String APP_ID = "appId";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * account data provider</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private SurenessAccountProvider accountProvider = new DocumentAccountProvider();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * login, this provider a get jwt api, convenient to test other api with jwt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param requestBody request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return response</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @PostMapping("/api/v1/account/auth")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ResponseEntity&lt;Object&gt; login(@RequestBody Map&lt;String,String&gt; requestBody) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (requestBody == null || !requestBody.containsKey(APP_ID)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                || !requestBody.containsKey("password")) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return ResponseEntity.badRequest().build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String appId = requestBody.get("appId");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String password = requestBody.get("password");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SurenessAccount account = accountProvider.loadAccount(appId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (account == null || account.isDisabledAccount() || account.isExcessiveAttempts()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return ResponseEntity.status(HttpStatus.FORBIDDEN).build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (account.getPassword() != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (account.getSalt() != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                password = Md5Util.md5(password + account.getSalt());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (!account.getPassword().equals(password)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return ResponseEntity.status(HttpStatus.FORBIDDEN).build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Get the roles the user has - rbac</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;String&gt; roles = account.getOwnRoles();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        long refreshPeriodTime = 36000L;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // issue jwt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String jwt = JsonWebTokenUtil.issueJwt(UUID.randomUUID().toString(), appId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                "token-server", refreshPeriodTime &gt;&gt; 1, roles,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                null, Boolean.FALSE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;String, String&gt; body = Collections.singletonMap("token", jwt);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return ResponseEntity.ok().body(body);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>请求api接口登录认证获取jwt</strong>    </p><p><img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3295df4eb54d4deb8498d3ae51aadcb8~tplv-k3u1fbpfcp-zoom-1.image" alt="image" class="img_ev3q"></p><p><strong>携带使用获取的jwt值请求api接口</strong>    </p><p><img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ec0f95fe506946df8b14c8fab5ffd9f2~tplv-k3u1fbpfcp-zoom-1.image" alt="image" class="img_ev3q">
<img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fb6b8c67ec474e229ba37e62654651d5~tplv-k3u1fbpfcp-zoom-1.image" alt="image" class="img_ev3q"></p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="鉴权测试">鉴权测试<a class="hash-link" href="#鉴权测试" title="Direct link to heading">​</a></h5><p>通过上面的sureness.yml文件配置的用户-角色-资源，我们可以关联下面几个典型测试点  </p><ol><li><code>/api/v1/source3===get</code>资源可以被任何直接访问，不需要认证鉴权  </li><li><code>api/v1/source2===get</code>资源持所有角色或无角色访问 前提是认证成功  </li><li>用户admin能访问<code>/api/v1/source1===get</code>资源,而用户root,tom无权限  </li><li>用户tom能访<code>/api/v1/source1===delete</code>资源，而用户admin.root无权限<br>测试如下：  </li></ol><p><strong><code>/api/v1/source3===get</code>资源可以被任何直接访问，不需要认证鉴权</strong><br>
<img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ae2b3db8d7b64c9abf18c243943f7a4d~tplv-k3u1fbpfcp-zoom-1.image" alt="image" class="img_ev3q"></p><p><strong><code>api/v1/source2===get</code>资源持所有角色或无角色访问 前提是认证成功</strong><br>
<img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ace184c86cc5438f91f7614b961dfab1~tplv-k3u1fbpfcp-zoom-1.image" alt="image" class="img_ev3q"></p><p><strong>用户admin能访问<code>/api/v1/source1===get</code>资源,而用户root,tom无权限</strong><br>
<img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f5fcd36befa84fb59b49c3cc35cb206e~tplv-k3u1fbpfcp-zoom-1.image" alt="image" class="img_ev3q">
<img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/45f9454365ef4a45abc90e436eb0d2f0~tplv-k3u1fbpfcp-zoom-1.image" alt="image" class="img_ev3q"></p><p><strong>用户tom能访<code>/api/v1/source1===delete</code>资源，而用户admin.root无权限</strong><br>
<img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e9bce40c97dd4aaf9924845922c4917b~tplv-k3u1fbpfcp-zoom-1.image" alt="image" class="img_ev3q">
<img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/209598b7717947c585bf479817b24726~tplv-k3u1fbpfcp-zoom-1.image" alt="image" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="其他">其他<a class="hash-link" href="#其他" title="Direct link to heading">​</a></h3><p>这次图文一步一步的详细描述了构建一个简单但完整的认证鉴权项目的流程，当然里面的授权账户等信息是写在配置文件里面的，实际的项目是会把这些数据写在数据库中。
万变不离其宗，无论是写配置文件还是数据库，它只是作为数据源提供数据，基于sureness我们也能轻松快速构建基于数据库的认证鉴权项目，支持动态刷新等各种功能。  </p><p>基于数据库方案的项目可参考下方样例-&gt;sureness集成springboot样例(数据库方案), 此次一步一步完成的系统源代码也在下方 -&gt; sureness集成springboot样例(配置文件方案)   </p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="demo源代码仓库">DEMO源代码仓库<a class="hash-link" href="#demo源代码仓库" title="Direct link to heading">​</a></h4><p><a href="https://github.com/dromara/sureness/tree/master/sample-bootstrap" target="_blank" rel="noopener noreferrer">sureness集成springboot样例-配置文件方案</a><br>
<a href="https://github.com/dromara/sureness/tree/master/sample-tom" target="_blank" rel="noopener noreferrer">sureness集成springboot样例-数据库方案</a></p>]]></content>
        <author>
            <name>tom</name>
            <uri>https://github.com/tomsun28</uri>
        </author>
        <category label="integrate" term="integrate"/>
        <category label="startup" term="startup"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Using Sureness to secure micronaut REST API]]></title>
        <id>/2021/04/29/sample-micronaut</id>
        <link href="https://usthe.com/sureness/zh-cn/blog/2021/04/29/sample-micronaut"/>
        <updated>2021-04-29T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Using Sureness to secure micronaut REST API by providing authentication(JWT,Basic,Digest) and authorization(RBAC)]]></summary>
        <content type="html"><![CDATA[<p>Using Sureness to secure micronaut REST API by providing authentication(JWT,Basic,Digest) and authorization(RBAC)</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-you-will-learn">What You Will Learn<a class="hash-link" href="#what-you-will-learn" title="Direct link to heading">​</a></h2><ul><li>Creating a simple REST API using micronaut</li><li>Learn how to integrate Sureness into a micronaut application</li><li>Test API authentication - use JWT Auth, Basic Auth, Digest Auth to test the security of the REST API</li><li>Test API authorization - use different users to verify that they can access the REST API</li></ul><p>The tutorial assumes that you know what  JWT, Basic Auth, Digest Auth, RBAC are. If you
do not, then you can check <a href="https://jwt.io/introduction/" target="_blank" rel="noopener noreferrer">jwt</a>, <a href="https://docs.oracle.com/cd/E50612_01/doc.11122/user_guide/content/authn_http_basic.html" target="_blank" rel="noopener noreferrer">basic auth</a> , <a href="https://docs.oracle.com/cd/E50612_01/doc.11122/user_guide/content/authn_http_digest.html" target="_blank" rel="noopener noreferrer">digest auth</a>, <a href="https://en.wikipedia.org/wiki/Role-based_access_control" target="_blank" rel="noopener noreferrer">rbac</a> for an introduction.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-dependencies">Setting Up Dependencies<a class="hash-link" href="#setting-up-dependencies" title="Direct link to heading">​</a></h2><p>First, you will need to create a maven project and add micronautn, Sureness dependencies coordinate</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;properties&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;release.version&gt;8&lt;/release.version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;packaging&gt;jar&lt;/packaging&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;jdk.version&gt;1.8&lt;/jdk.version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;micronaut.version&gt;2.4.3&lt;/micronaut.version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;micronaut-maven-plugin.version&gt;1.1.8&lt;/micronaut-maven-plugin.version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;maven-compiler-plugin.version&gt;3.8.1&lt;/maven-compiler-plugin.version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;exec.mainClass&gt;com.usthe.sureness.micronaut.Application&lt;/exec.mainClass&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;micronaut.runtime&gt;netty&lt;/micronaut.runtime&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/properties&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;dependencyManagement&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependencies&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;groupId&gt;io.micronaut&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;artifactId&gt;micronaut-bom&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;version&gt;${micronaut.version}&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;type&gt;pom&lt;/type&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;scope&gt;import&lt;/scope&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependencies&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/dependencyManagement&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;dependencies&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;version&gt;1.7.30&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;com.usthe.sureness&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;artifactId&gt;sureness-core&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;io.micronaut&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;artifactId&gt;micronaut-inject&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;scope&gt;compile&lt;/scope&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;io.micronaut&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;artifactId&gt;micronaut-validation&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;scope&gt;compile&lt;/scope&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;scope&gt;runtime&lt;/scope&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;artifactId&gt;junit-jupiter-api&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;scope&gt;test&lt;/scope&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;artifactId&gt;junit-jupiter-engine&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;scope&gt;test&lt;/scope&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;io.micronaut.test&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;artifactId&gt;micronaut-test-junit5&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;scope&gt;test&lt;/scope&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;io.micronaut&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;artifactId&gt;micronaut-http-client&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;scope&gt;compile&lt;/scope&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;io.micronaut&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;artifactId&gt;micronaut-http-server-netty&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;scope&gt;compile&lt;/scope&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;io.micronaut&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;artifactId&gt;micronaut-runtime&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;scope&gt;compile&lt;/scope&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/dependencies&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;build&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;plugins&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;plugin&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;groupId&gt;io.micronaut.build&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;artifactId&gt;micronaut-maven-plugin&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;version&gt;${micronaut-maven-plugin.version}&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;/plugin&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;plugin&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;version&gt;${maven-compiler-plugin.version}&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;configuration&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &lt;annotationProcessorPaths combine.children="append"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &lt;path&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            &lt;groupId&gt;io.micronaut&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            &lt;artifactId&gt;micronaut-inject-java&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            &lt;version&gt;${micronaut.version}&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &lt;/path&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &lt;path&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            &lt;groupId&gt;io.micronaut&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            &lt;artifactId&gt;micronaut-validation&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            &lt;version&gt;${micronaut.version}&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &lt;/path&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &lt;/annotationProcessorPaths&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &lt;compilerArgs&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &lt;arg&gt;-Amicronaut.processing.group=com.usthe.sureness&lt;/arg&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &lt;arg&gt;-Amicronaut.processing.module=micronaut-sureness&lt;/arg&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &lt;/compilerArgs&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;/configuration&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;/plugin&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/plugins&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/build&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><a href="https://docs.micronaut.io/2.4.3/guide/index.html" target="_blank" rel="noopener noreferrer">User Guide</a></li><li><a href="https://docs.micronaut.io/2.4.3/api/index.html" target="_blank" rel="noopener noreferrer">API Reference</a></li><li><a href="https://docs.micronaut.io/2.4.3/guide/configurationreference.html" target="_blank" rel="noopener noreferrer">Configuration Reference</a></li><li><a href="https://guides.micronaut.io/index.html" target="_blank" rel="noopener noreferrer">Micronaut Guides</a></li></ul><p>We need to create a simple micronautn app and provide some  REST API for test.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-sureness">Setting Up Sureness<a class="hash-link" href="#setting-up-sureness" title="Direct link to heading">​</a></h2><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1run-micronaut-application">1.Run Micronaut Application<a class="hash-link" href="#1run-micronaut-application" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.micronaut.runtime.Micronaut;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Application{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Micronaut.run(Application.class, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-config-document-datasource---surenessyml">2. Config Document Datasource - <code>sureness.yml</code><a class="hash-link" href="#2-config-document-datasource---surenessyml" title="Direct link to heading">​</a></h4><p>Sureness authentication requires us to provide our own account data, role permission data. These data may come from document, databases,, annotations, etc. When we use sureness default configuration above, the datasource is document - <code>sureness.yml</code>.</p><p>Create a file named <code>sureness.yml</code> in the <code>resource</code> directory. Configure account data, role permission data in the <code>sureness.yml</code>.  eg:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## -- sureness.yml document dataSource-- ##</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># load api resource which need be protected, config role who can access these resource.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># resources that are not configured are also authenticated and protected by default, but not authorized</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># eg: /api/v2/host===post===[role2,role3] means /api/v2/host===post can be access by role2,role3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># eg: /api/v1/source2===get===[] means /api/v1/source2===get can not be access by any role</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">resourceRole</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /api/v1/source1===get===</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">role2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /api/v1/source1===post===</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">role1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /api/v1/source1===delete===</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">role3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /api/v1/source1===put===</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">role1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">role2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /api/v1/source2===get===</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /api/v2/host===post===</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">role2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">role3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /api/v2/host===get===</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">role2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">role3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /api/v2/host===delete===</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">role2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">role3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /api/v2/host===put===</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">role2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">role3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /api/v3/</span><span class="token important">*===*===</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">role1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">role2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">role3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># load api resource which do not need be protected, means them need be excluded.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># these api resource can be access by everyone</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">excludedResource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /api/v3/host===get</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /</span><span class="token important">**/*.html===get</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /</span><span class="token important">**/*.js===get</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /</span><span class="token important">**/*.css===get</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /</span><span class="token important">**/*.ico===get</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># account info</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># there are three account: admin, root, tom</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># eg: admin has [role1,role2] ROLE, unencrypted password is admin, encrypted password is 0192023A7BBD73250516F069DF18B500</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># eg: root has role1, unencrypted password is 23456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># eg: tom has role3, unencrypted password is 32113</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">account</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">appId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># if add salt, the password is encrypted password - the result: MD5(password+salt)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># digest auth not support encrypted password</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># if no salt, the password is unencrypted password</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">credential</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 0192023A7BBD73250516F069DF18B500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">salt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">123</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">role</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">role1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">role2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">appId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">credential</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">23456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">role</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">role1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">role2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">appId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tom</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">credential</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">32113</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">role</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">role3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-add-an-interceptor-intercepting-all-requests">3. Add an Interceptor Intercepting All Requests<a class="hash-link" href="#3-add-an-interceptor-intercepting-all-requests" title="Direct link to heading">​</a></h4><p>The essence of sureness is to intercept all rest requests for authenticating and authorizing.     The interceptor can be a filter or interceptor, it intercepts all request to check them. In Micronaut, we use Filter</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token annotation punctuation" style="color:#393A34">@Filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/**"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">MicronautSurenessFilterExample</span><span class="token plain">  </span><span class="token keyword" style="color:#00009f">implements</span><span class="token plain"> </span><span class="token class-name">HttpServerFilter</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">Logger</span><span class="token plain"> logger </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">LoggerFactory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getLogger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">MicronautSurenessFilterExample</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Inject</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">SurenessSecurityManager</span><span class="token plain"> securityManager </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">Publisher</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">MutableHttpResponse</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics operator" style="color:#393A34">?</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">doFilter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">HttpRequest</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics operator" style="color:#393A34">?</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                             </span><span class="token class-name">ServerFilterChain</span><span class="token plain"> chain</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Integer</span><span class="token plain"> statusCode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">String</span><span class="token plain"> errorMsg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">SubjectSum</span><span class="token plain"> subject </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">securityManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">checkIn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">subject </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name">SurenessContextHolder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">bindSubject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">subject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ProcessorNotFoundException</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token class-name">UnknownAccountException</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token class-name">UnsupportedSubjectException</span><span class="token plain"> e4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">debug</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"this request is illegal"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            statusCode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">HttpStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">BAD_REQUEST</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getCode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            errorMsg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> e4</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getMessage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">DisabledAccountException</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token class-name">ExcessiveAttemptsException</span><span class="token plain"> e2 </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">debug</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"the account is disabled"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            statusCode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">HttpStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FORBIDDEN</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getCode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            errorMsg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> e2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getMessage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">IncorrectCredentialsException</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token class-name">ExpiredCredentialsException</span><span class="token plain"> e3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">debug</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"this account credential is incorrect or expired"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            statusCode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">HttpStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FORBIDDEN</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getCode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            errorMsg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> e3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getMessage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">UnauthorizedException</span><span class="token plain"> e5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">debug</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"this account can not access this resource"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            statusCode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">HttpStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FORBIDDEN</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getCode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            errorMsg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> e5</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getMessage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">RuntimeException</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"other exception happen: "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            statusCode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">HttpStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FORBIDDEN</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getCode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            errorMsg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getMessage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">statusCode </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> errorMsg </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">String</span><span class="token plain"> finalErrorMsg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> errorMsg</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">Integer</span><span class="token plain"> finalStatusCode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> statusCode</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">statusCode</span><span class="token operator" style="color:#393A34">+</span><span class="token string" style="color:#e3116c">"---&gt;"</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">errorMsg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name">URI</span><span class="token plain"> location </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">URI</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/auth/error"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                request </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">mutate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">headers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">httpHeaders </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    httpHeaders</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"statusCode"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">valueOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">finalStatusCode</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    httpHeaders</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"errorMsg"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> finalErrorMsg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">uri</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">location</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token keyword" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">URISyntaxException</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"uri error"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> chain</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">proceed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getOrder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">ServerFilterPhase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SECURITY</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">order</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>SurenessSecurityManager configuration</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">io</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">micronaut</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">context</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">annotation</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">Factory</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token annotation punctuation" style="color:#393A34">@Factory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">SurenessConfiguration</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">Logger</span><span class="token plain"> logger </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">LoggerFactory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getLogger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">SurenessConfiguration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Factory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">SurenessSecurityManager</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">SurenessAccountProvider</span><span class="token plain"> accountProvider </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">DocumentAccountProvider</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Processor</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> processorList </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">LinkedList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">NoneProcessor</span><span class="token plain"> noneProcessor </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">NoneProcessor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        processorList</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">noneProcessor</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">PasswordProcessor</span><span class="token plain"> passwordProcessor </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">PasswordProcessor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        passwordProcessor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setAccountProvider</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">accountProvider</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        processorList</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">passwordProcessor</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">DefaultProcessorManager</span><span class="token plain"> processorManager </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">DefaultProcessorManager</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">processorList</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isDebugEnabled</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">debug</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"DefaultProcessorManager init"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">PathTreeProvider</span><span class="token plain"> pathTreeProvider </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">DocumentPathTreeProvider</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">DefaultPathRoleMatcher</span><span class="token plain"> pathRoleMatcher </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">DefaultPathRoleMatcher</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pathRoleMatcher</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setPathTreeProvider</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pathTreeProvider</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pathRoleMatcher</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">buildTree</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isDebugEnabled</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">debug</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"DefaultPathRoleMatcher init"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// SubjectFactory init</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">SubjectFactory</span><span class="token plain"> subjectFactory </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">SurenessSubjectFactory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">SubjectCreate</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> subjectCreates </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Arrays</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">asList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">NoneSubjectReactiveCreator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">BasicSubjectReactiveCreator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        subjectFactory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">registerSubjectCreator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">subjectCreates</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isDebugEnabled</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">debug</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"SurenessSubjectFactory init"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// surenessSecurityManager init</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">SurenessSecurityManager</span><span class="token plain"> securityManager </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">SurenessSecurityManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        securityManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setPathRoleMatcher</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pathRoleMatcher</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        securityManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setSubjectFactory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">subjectFactory</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        securityManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setProcessorManager</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">processorManager</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isDebugEnabled</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">debug</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"SurenessSecurityManager init"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> securityManager</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-last-implement-auth-exception-handling-process">4. Last, Implement Auth Exception Handling Process<a class="hash-link" href="#4-last-implement-auth-exception-handling-process" title="Direct link to heading">​</a></h4><p>Sureness uses exception handling process:</p><ul><li>If auth success, method - <code>checkIn()</code> will return a <code>SubjectSum</code> object containing user information.</li><li>If auth failure, method - <code>checkIn()</code> will throw different types of auth exceptions.</li></ul><p>We need to continue the subsequent process based on these exceptions.(eg: return the request response)</p><p>Here we need to customize the exceptions thrown by <code>checkIn</code>, passed directly when auth success, catch exception when auth failure and do something:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// when auth error , add error msg to HttpRequest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   if (statusCode != null &amp;&amp; errorMsg != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String finalErrorMsg = errorMsg;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Integer finalStatusCode = statusCode;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger.info(statusCode+"---&gt;"+errorMsg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                URI location = new URI("/auth/error");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                request = request.mutate().headers(httpHeaders -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    httpHeaders.add("statusCode", String.valueOf(finalStatusCode));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    httpHeaders.add("errorMsg", finalErrorMsg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }).uri(location);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }catch (URISyntaxException e){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                logger.error("uri error");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>All done, we can test now!</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="test">Test<a class="hash-link" href="#test" title="Direct link to heading">​</a></h2><p>Through the above steps, a complete auth function project is completed. Someone maybe think that with only these few steps, where is its complete function and what can it support?<br>
<!-- -->This built project is based on the RBAC permission model and supports Baisc authentication, Digest authentication and JWT authentication. It can fine-grained control the user's access to the restful api provided by the Javalin. That is to control which users can access which api.</p><p>Let's test it. (we use postman and chrome to test.)</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="test-authentication">Test Authentication<a class="hash-link" href="#test-authentication" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-basic-auth-test">1. Basic Auth Test<a class="hash-link" href="#1-basic-auth-test" title="Direct link to heading">​</a></h4><p>Use postman Basic auth, as shown below:</p><ul><li>success - input username: admin, password: admin</li></ul><p><img loading="lazy" alt="success" src="/sureness/zh-cn/assets/images/success-566c8b8e44aa014636b5ce56cef43aef.png" width="784" height="568" class="img_ev3q"></p><ul><li>fail - input username: admin, password: admin1234</li></ul><p><img loading="lazy" alt="fail" src="/sureness/zh-cn/assets/images/error-d143a3b62627677352d3ca8ca6ba2527.png" width="848" height="593" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">​</a></h2><p>micronaut is a framework dedicated to simplicity and ease of use, and so is Sureness.<br>
<!-- -->We hope you enjoy this tutorial. Of course, the tutorial only introduces a simple introduction. Our account data, role permission data can not only be written in <code>sureness.yml</code>, but also loaded and obtained from the database and annotations. We can also customize the authentication method, data source, etc.<br>
<!-- -->Finally, thank you again for reading.</p><p><a href="https://github.com/usthe/sureness/tree/master/samples/javalin-sureness" target="_blank" rel="noopener noreferrer">DEMO SOURCE CODE ON GITHUB</a></p>]]></content>
        <author>
            <name>ChineseTony</name>
            <uri>https://github.com/ChineseTony</uri>
        </author>
        <category label="integrate" term="integrate"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Using Sureness to secure Javalin REST API]]></title>
        <id>/2021/04/16/sample-javalin</id>
        <link href="https://usthe.com/sureness/zh-cn/blog/2021/04/16/sample-javalin"/>
        <updated>2021-04-16T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[javalin-sureness sample repository]]></summary>
        <content type="html"><![CDATA[<p><a href="https://github.com/tomsun28/sureness/tree/master/samples/javalin-sureness" target="_blank" rel="noopener noreferrer">javalin-sureness sample repository</a></p><p>Using Sureness to secure Javalin REST API by providing authentication(JWT,Basic,Digest) and authorization(RBAC)</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-you-will-learn">What You Will Learn<a class="hash-link" href="#what-you-will-learn" title="Direct link to heading">​</a></h2><ul><li>Creating a simple REST API using Javalin</li><li>Learn how to integrate Sureness into a Javalin application</li><li>Learn how to issue a JWT</li><li>Test API authentication - use JWT Auth, Basic Auth, Digest Auth to test the security of the REST API</li><li>Test API authorization - use different users to verify that they can access the REST API</li></ul><p>The tutorial assumes that you know what  JWT, Basic Auth, Digest Auth, RBAC are. If you
do not, then you can check <a href="https://jwt.io/introduction/" target="_blank" rel="noopener noreferrer">jwt</a>, <a href="https://docs.oracle.com/cd/E50612_01/doc.11122/user_guide/content/authn_http_basic.html" target="_blank" rel="noopener noreferrer">basic auth</a> , <a href="https://docs.oracle.com/cd/E50612_01/doc.11122/user_guide/content/authn_http_digest.html" target="_blank" rel="noopener noreferrer">digest auth</a>, <a href="https://en.wikipedia.org/wiki/Role-based_access_control" target="_blank" rel="noopener noreferrer">rbac</a> for an introduction.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-dependencies">Setting Up Dependencies<a class="hash-link" href="#setting-up-dependencies" title="Direct link to heading">​</a></h2><p>First, you will need to create a maven project and add Javalin, Sureness dependencies coordinate</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;io.javalin&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;artifactId&gt;javalin&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;version&gt;{{site.javalinversion}}&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;com.usthe.sureness&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;artifactId&gt;sureness-core&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;version&gt;1.0.2&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;version&gt;1.7.30&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-javalin-and-create-rest-api">Setting Up Javalin and Create REST API<a class="hash-link" href="#setting-up-javalin-and-create-rest-api" title="Direct link to heading">​</a></h2><p>We need to create a simple Javalin app and provide some  REST API for test.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">        // init javalin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Javalin app = Javalin.create().start(8088);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">        // create simple rest api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // simple rest api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app.routes(() -&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            path("api", () -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                path("v3", () -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    get("host", ctx -&gt; ctx.result("get /api/v3/host success"));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    put("book", ctx -&gt; ctx.result("put /api/v3/book success"));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                path("v2", () -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    path("host", () -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        get(ctx -&gt; ctx.result("get /api/v2/host success"));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        post(ctx -&gt; ctx.result("post /api/v2/host success"));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        put(ctx -&gt; ctx.result("put /api/v2/host success"));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        delete(ctx -&gt; ctx.result("delete /api/v2/host success"));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                path("v1", () -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    path("source1", () -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        get(ctx -&gt; ctx.result("get /api/v1/source1 success"));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        post(ctx -&gt; ctx.result("post /api/v1/source1 success"));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        put(ctx -&gt; ctx.result("put /api/v1/source1 success"));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        delete(ctx -&gt; ctx.result("delete /api/v1/source1 success"));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }));</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-sureness">Setting Up Sureness<a class="hash-link" href="#setting-up-sureness" title="Direct link to heading">​</a></h2><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-use-the-default-configuration-to-configure-sureness">1. Use the Default Configuration to Configure Sureness<a class="hash-link" href="#1-use-the-default-configuration-to-configure-sureness" title="Direct link to heading">​</a></h4><p>The default configuration -<code>DefaultSurenessConfig</code> uses the document datasource <code>sureness.yml</code> as the auth datasource.<br>
<!-- -->It supports JWT, Basic Auth, Digest Auth authentication.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // init sureness default config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        new DefaultSurenessConfig();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-config-document-datasource---surenessyml">2. Config Document Datasource - <code>sureness.yml</code><a class="hash-link" href="#2-config-document-datasource---surenessyml" title="Direct link to heading">​</a></h4><p>Sureness authentication requires us to provide our own account data, role permission data. These data may come from document, databases,, annotations, etc. When we use sureness default configuration above, the datasource is document - <code>sureness.yml</code>.</p><p>Create a file named <code>sureness.yml</code> in the <code>resource</code> directory. Configure account data, role permission data in the <code>sureness.yml</code>.  eg:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## -- sureness.yml document dataSource-- ##</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># load api resource which need be protected, config role who can access these resource.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># resources that are not configured are also authenticated and protected by default, but not authorized</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># eg: /api/v2/host===post===[role2,role3] means /api/v2/host===post can be access by role2,role3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># eg: /api/v1/source2===get===[] means /api/v1/source2===get can not be access by any role</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">resourceRole</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /api/v1/source1===get===</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">role2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /api/v1/source1===post===</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">role1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /api/v1/source1===delete===</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">role3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /api/v1/source1===put===</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">role1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">role2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /api/v1/source2===get===</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /api/v2/host===post===</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">role2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">role3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /api/v2/host===get===</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">role2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">role3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /api/v2/host===delete===</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">role2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">role3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /api/v2/host===put===</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">role2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">role3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /api/v3/</span><span class="token important">*===*===</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">role1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">role2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">role3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># load api resource which do not need be protected, means them need be excluded.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># these api resource can be access by everyone</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">excludedResource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /api/v3/host===get</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /</span><span class="token important">**/*.html===get</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /</span><span class="token important">**/*.js===get</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /</span><span class="token important">**/*.css===get</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /</span><span class="token important">**/*.ico===get</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># account info</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># there are three account: admin, root, tom</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># eg: admin has [role1,role2] ROLE, unencrypted password is admin, encrypted password is 0192023A7BBD73250516F069DF18B500</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># eg: root has role1, unencrypted password is 23456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># eg: tom has role3, unencrypted password is 32113</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">account</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">appId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># if add salt, the password is encrypted password - the result: MD5(password+salt)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># digest auth not support encrypted password</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># if no salt, the password is unencrypted password</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">credential</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 0192023A7BBD73250516F069DF18B500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">salt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">123</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">role</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">role1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">role2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">appId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">credential</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">23456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">role</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">role1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">role2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">appId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tom</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">credential</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">32113</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">role</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">role3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-add-an-interceptor-intercepting-all-requests">3. Add an Interceptor Intercepting All Requests<a class="hash-link" href="#3-add-an-interceptor-intercepting-all-requests" title="Direct link to heading">​</a></h4><p>The essence of sureness is to intercept all rest requests for authenticating and authorizing.     The interceptor can be a filter or interceptor, it intercepts all request to check them. In Javalin, we use <code>app.before()</code>.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">        // intercept all rest requests for authenticating and authorizing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app.before(ctx -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            SubjectSum subject = SurenessSecurityManager.getInstance().checkIn(ctx.req);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // when auth error , the exception throw, you should use app.exception() catch it and define return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (subject != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                SurenessContextHolder.bindSubject(subject);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app.after(ctx -&gt;  SurenessContextHolder.unbindSubject());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-last-implement-auth-exception-handling-process">4. Last, Implement Auth Exception Handling Process<a class="hash-link" href="#4-last-implement-auth-exception-handling-process" title="Direct link to heading">​</a></h4><p>Sureness uses exception handling process:</p><ul><li>If auth success, method - <code>checkIn()</code> will return a <code>SubjectSum</code> object containing user information.</li><li>If auth failure, method - <code>checkIn()</code> will throw different types of auth exceptions.</li></ul><p>We need to continue the subsequent process based on these exceptions.(eg: return the request response)</p><p>Here we need to customize the exceptions thrown by <code>checkIn</code>, passed directly when auth success, catch exception when auth failure and do something:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">        // when auth error , the exception throw, you should use app.exception() catch it and define return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app.exception(UnknownAccountException.class, (e, ctx) -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.debug("this request user account not exist");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ctx.status(401).result(e.getMessage());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }).exception(IncorrectCredentialsException.class, (e, ctx) -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.debug("this account credential is incorrect");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ctx.status(401).result(e.getMessage());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }).exception(ExpiredCredentialsException.class, (e, ctx) -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.debug("this account credential expired");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ctx.status(401).result(e.getMessage());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }).exception(NeedDigestInfoException.class, (e, ctx) -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.debug("you should try once again with digest auth information");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ctx.status(401).header("WWW-Authenticate", e.getAuthenticate());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }).exception(UnauthorizedException.class, (e, ctx) -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.debug("this account can not access this resource");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ctx.status(403).result(e.getMessage());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }).exception(Exception.class, (e, ctx) -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.error("other exception happen: ", e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ctx.status(500).result(e.getMessage());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="provide-an-issue-jwt-api">Provide an Issue JWT Api<a class="hash-link" href="#provide-an-issue-jwt-api" title="Direct link to heading">​</a></h2><p>Now we provide a REST API to issue JWT. We can use this JWT to test JWT auth.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">       // issue jwt rest api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app.get("/auth/token", ctx -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            SubjectSum subjectSum = SurenessContextHolder.getBindSubject();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (subjectSum == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ctx.result("Please auth!");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                String principal = (String) subjectSum.getPrincipal();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                List&lt;String&gt; roles = (List&lt;String&gt;) subjectSum.getRoles();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // issue jwt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                String jwt = JsonWebTokenUtil.issueJwt(UUID.randomUUID().toString(), principal,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        "token-server", 3600L, roles);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ctx.result(jwt);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>All done, we can test now!</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="test">Test<a class="hash-link" href="#test" title="Direct link to heading">​</a></h2><p>Through the above steps, a complete auth function project is completed. Someone maybe think that with only these few steps, where is its complete function and what can it support?<br>
<!-- -->This built project is based on the RBAC permission model and supports Baisc authentication, Digest authentication and JWT authentication. It can fine-grained control the user's access to the restful api provided by the Javalin. That is to control which users can access which api.</p><p>Let's test it. (we use postman and chrome to test.)</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="test-authentication">Test Authentication<a class="hash-link" href="#test-authentication" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-basic-auth-test">1. Basic Auth Test<a class="hash-link" href="#1-basic-auth-test" title="Direct link to heading">​</a></h4><p>Use postman Basic auth, as shown below:</p><ul><li>success - input username: admin, password: admin</li></ul><p><img loading="lazy" alt="success" src="/sureness/zh-cn/assets/images/test1-af3495bc45a9116b5401c8c1b40f32eb.PNG" width="1280" height="552" class="img_ev3q"></p><ul><li>fail - input username: admin, password: 12345</li></ul><p><img loading="lazy" alt="fail" src="/sureness/zh-cn/assets/images/test2-04e523ebd1c8c584b328d365a6524ad1.PNG" width="1279" height="555" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-digest-auth-test">2. Digest Auth Test<a class="hash-link" href="#2-digest-auth-test" title="Direct link to heading">​</a></h4><p>Note: If password has been encrypted,  Digest auth not support.(So the account admin not support Digest auth).<br>
<!-- -->Use chrome to Digest auth, as shown below:</p><p><img loading="lazy" alt="success" src="/sureness/zh-cn/assets/images/test3-3ef3fd841ccac2285197c8ba50d7e93c.PNG" width="2422" height="375" class="img_ev3q"></p><p><img loading="lazy" alt="success" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABYQAAACeCAYAAACCXg4YAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAABdOSURBVHhe7d3LryRXYcfxu+RPYGkkFixZsmTJEllCQggRFBTJBAs5IXFQbBggFhZI2BAjkIgQYPwQD8WxMSHCPCIMM0ACjhQR24AxhMUIjEQYz8Nje6bSp6pOd9WpU9XV93bP7Tvn85G+DHO7bj/q9mx+FH0PKgAAAAAAimAQBgAAAAAohEEYAAAAAKAQBmEAAAAAgEIYhDmyl15+ubr0wuXq/IWL1fPnL1Tnnj9f/UmSJEmSJEnS3mUQ5lCuXr1aXXzhheybSpIkSZIkSdJ+ZhBmI4ZgSZIkSZIk6eRmEGa2K1evVufOX8i+ka5V/5f5miRJkiRJkqR5GYSZ5cqVK8c+BkuSJEmSJEk6WgZh1nr5ypXsm0eSJEmSJEnSycogzFrPuzJYkiRJkiRJui4yCDPpwsVL2TeOJEmSJEmSpJOXQZhRl198KfumkSRJkiRJknQy2/kg/Nxzf6h+85v/bf+2n/507lx18eLF9m/7I5y7J5/6+bLw9zEXLlxo/9v2nDuff9Ns2s+efLp65NF/rb78la/Wf4a/546TJEmSJEmStNt2OgiHIfidN/9V9WfvuKn9yn765re+U33n379XD8P74Mmnnq7u/Ohd9XlLe98H7qhv7/rMZz8/+NpRXbp8OfuG2aTHFuf1b/7276o/f8dfDApff+zb38l+32adrm571aurt9z368xtu++Z+95W3fCqU9Xj8WvPPlC95VVvq+59tn+cJEmSJEmStA/tbBDujsFhsNxn//2z/9mbUTicqzj+/vWtf1/d9+CXqn/+l6/Vf4a/x9v+6bNf6B2/7UH43BF+kdzZ3/2+uvvj/9gZf2+tPn/vF6svffmr9Z/h7/G2cFw4Pnc/8zIIz+0Xj3yweudf3tz2werhZ3LH/ai6Z3nMolOPVr8YHDPzvp55tHp/577e/8ivhsd0a4+/54eZ247S2vttXvPa55ftV9XDp8bOZaddvba9aua5kCRJkiRJx9pOBuGTNAZH+zAKx3H3pptvGR14f/LTJ5bD8Htuva3+c9uD8MtXrmTfLHO76+5P1GPvu25+d32VcO6Y8PVwexyFc8fMq/BBeObjNQNuZ6z74afqkbY/UKbDaBj4hqPwrPtqB9DVfbVD8yd/tDomqb7fkQH6SK0bY+vn/6nqdO62qdr7HR/XV+3ste1LG5wLSZIkSZJ0vG19ED6JY3B0nKPw975/uj5nYexd93nA4fYwGscxeNuD8FE+LiIMvXEM7n5W8H8+8V/1ZwiHP+PXwu1xFB4bjtdnEF7/ePkrYE9/sj/2ZkfLwZg6777Sv9fVw+vYYNiMz4e7Svdo1c91Yqge1o7by9aNoMf32nbfpudCkiRJkiQdd1sdhE/yGBwd1ygcr/oN53CdeCVxt20OwhcuXsq+WeYUPw7i+6dP974ePi4ifD382f16HJDDZwp3vz4/g/Daxxu5QrY/AI+Nlu1VwnEw3eC+BiNr/b0jg+Fhr9I9alPPaazu98z5/uN6bdeiTc+FJEmSJEk69rY2CF8PY3B0rUfh8DEQ4bx9/J5PtV8ZlxuDQ9schJ+/cDH7ZllXuOK3GXdvHdwWrgwOY3D3CuFYHJG7VxTPb2wQbr5+Q6f8aPzr6t639o+74fY4Zmdue+sD1TOd758ahB+/vfu9nWOWTT12px+c6h9T31fmexc1rzH9eIaJq3rXDL3L45Zj74z7in/PXiGcH0aHV+m2o3J4HbHk/lYjdHqVavIYE6+tN2SPXsE8MnCHZoygc17bYIivn0v3mPQx8j+H4XNtjguvvX4e4b56zyU9d8l9tudueXv6M+1mEJYkSZIk6US0lUH4uef+sByDw58PPfzoRs25KvYowqj7y2d+tVFhDI6j8MWLF9t72o3wS+PCuQsfGzElnKdwbK7wM9iWw/5CuUe+9vV62A2/OC69LfeREbFwfPi+8P3pbevLDMLtgNr7Wj3UvjoZXNvRuDfyLr4Wj1ncT39Ebo/v3Ed+EG7G2dt+EL+vHW+7jzP3+dSvpX8F8OO3r7siuR35OsNfPXx2x7p0/JwY8/pX/864r1A7JK7GxbEBMx6bfP/iPvvHjrymUx9cfG93AI5ja+dr7XMZDsKrsbT798FzHP3+eFv+vOVvz4zLi2Pu6TxmM9z277M55zOe68gg/P7FeRo8//Z1jT6XdpRefV9732Oj8LpzIUmSJEmS9qKtDMJhkOxerbpp4ft3KQy8Ydw9bOH7dymev21e5XsUuTfKnMY+FuIot60vHYSb8bU/5LYl42p9BW9yxe+66gG48z1jg/Dg8XOPnbsauP3+OCanjzcoOwjni6NiUzLcTYx5zff1r7qdvK9YHBzbsmPwombYnbjytC09rnkOucdOxtL2eQwG0Xrw7L+u3JXNk89vzQg6/N50hE6auL/+c9tsEO6Nvtnj0kZuHzuXy9vGz4UkSZIkSdqPtjIIh19y9uGPfGw58N734JeWV66u69+++a21v0TtqF588cX66truFcBTPfX0z5dj8H/85Kf19+9SOA/7NAjv4grhqdF3q1cITw6k3WPTIXm8/kc/hFYD8NRHRnTvoz/0No+9uoK4W3s1cecq5foxc+NxaNYgnBv3kqFwYszrj5oz7it+T25sTb4W729sLF5+zMGy1fePD7XJcxwZMev77r2ORYNjp5/f9Aia+972uc0610m9K7E3G4QHx42ck/7tuec49riLJs+FJEmSJEnal7b2GcJh1L391D/Uw+b7PnDHzkfeXQnj75kf/rgeg8/86Mc7H4ODMIrHIX0T4WMitvlREdHRP0N4+AvipgbhrX6GcOYjFrLH9gbafM3Y2x9j0wH4UIPw5GMng3CoPT4do1e3TQ/CuXG2rjswTgyE3StTj3ZfmTExc5VuqHmc/mCbPvb4eDpjEB4dL5Pv7Y2wmaZG0JHXFuoO3d3z0T3X3ePres9ls0F48LNY97rq21fPMc0gLEmSJEnSyW1rg3Bw0kfh4xiDgzDqhnP2nltva7+yXji34fjwmc3bduHipeybZU5x3P3+6f4VrWOD8GOLc92MyMNfRDevZBCeHEi7x05dpbtoZLTdyiA8+diZQTi9rXv/Mwbh8ZGxOxbOGxhn3dfE2Fh/f2fkTf9eNzIobzoIL19L5v7Gv7f/ONnn121iBF37vaE4vLbHTT2v/nlNXuOymYPwuvH2MOPuYb5HkiRJkiRd87Y6CAcndRQ+rjE4+sxnP7/RVcLhuHB8+L5tu3T5cvbNMqc48L7r5nf3rvgNv0wujMHdXyoXbg/HhePD98Wvb1YyCA/+3ql39fDU8LooOwjHQfaog/DEY2cft1syJs8YhNMhdVky3GbH3mRMnXVfyfesSkbnsQEx+/3t0JkOwnO+f3B/IyPpsnj7uuMWTb6GzNcz9UbgdWP68ueTDr9t7WtdOwinP4tB627PtMFrliRJkiRJx9fWB+HgpI3Cxz0GB+Eq4ZtuvqU+Zw89/Gj71bw4Bofjd3FuX75yJftmmdtdd39iOQo/9u380BsG4DgGh+Nzx8wrMwC3n7vb+1o7tOa+1h9mF/dX/7253+5tzfi7jUF49ffBYw8e81T/vgYfiZF5/e2Yl46C/fGw/Vp3AG7HxNUImBsd591XPV4mw3HztdVgOH417PAxmvG3f5/Lr/XuY/x1LUfRenTNjNqdmuea3nemkRF08rX1zt3wHKfnKdS81tzXumNvHM2799ecj+yoXZ+HZPRdvJ572r8P7z+0eIxPjpwTg7AkSZIkSSeinQzCQXcUvvOjd7Vf3U/hF8cd5xgchV98F0fhcM4e/8GZ5eAbbgt/Dx8TEcfg8LVdOewvlgud/d3vl6NwKHym8Bfu/WL15a98tf4z/D3eFo4Lx+fuZ165QXRRHFw75a+6bUfY3HHJfYTH2M5HRsSGj52+jtUIHRved/eY5vuHg2pvLGzLXv3ZjqfL43r3EZt3X8vBNtYbSJv7GL0CNXke4bjm/pJBONxnO2wuS59ze19x2KwH1+zr6pQbS3NlR9Cp19b+bLplnsvg3I0M2Mvhui48j/Zns7zPiUE4lP6809eSnttF0/dlEJYkSZIkad/b2SAcdEfhfbYPY3AURt4Pf+Rj9TkbK9y+yzE4uPTCC9k3zCaFq4DjZwqnha8f/mMidOKbcZXuupaDcOa20a7FaLmF1yZJkiRJkrSrdjoIB2EU3vV4eVR/OnduL8bgrieferr+fOAw/sbCR0WEr18ruTfMYQqfFfzI175ef4Zw+LP72cIqsfQq1sN1mEG4vqJ20xF5o7bz2iRJkiRJknbVzgdhTq4XLr+YfdNI+9ChrhCWJEmSJEkqPIMwk85fuJh940jHnUFYkiRJkiRp8wzCTLp69Wr1/BF+wZwkSZIkSZKk/ckgzFpXrl7NvnkkSZIkSZIknawMwsxSXyl8wZXCkiRJkiRJ0knOIMxGLly6lH0jSZIkSZIkSdr/DMJs7MWXXqrOHdfnCi8e99z58N/D4z8vSZIkSZIkaYMMwhzapRcuL95EyWArSZIkSZIkaW8zCHNkL738cj0On79wsXo+XMGbeaNJkiRJkiRJOv4MwgAAAAAAhTAIAwAAAAAUwiAMAAAAAFAIgzAAAAAAQCEMwgAAAAAAhegNwj//5a8lSZIkSZIkSddpBmFJkiRJkiRJKiQfGQEAAAAAUAiDMAAAAABAIQzCAAAAAACFMAgDAAAAABTCIAwAAAAAUAiDMAAAAABAIQzCAAAAAACFMAgDAAAAABTCIAwAAAAAUAiDMAAAAABAIQzCAAAAAACFMAgDAAAAABTCIAwAAAAAUAiDMAAAAABAIQzCAAAAAACFMAgDAAAAABTCIAwAAAAAUAiDMAAAAABAIQzCAAAAAACFMAgDAAAAABTiOhmET1d3HBxUd5xp/7p1zf0fHNyx+G8znLlj/rFHdPaBG6uDN91fnW3/DgAAAAAw5poPwrsYMHc/im4yCJ+t7n/TQXXjA4d8Nr+9v7oxPNas17PrIXz/nP5Q+DmU9ZoBAAAAYFuug0G4GWD3ZiCsB93DXB3cvI5wbu4Po+eccxSuRN7pEL5H6quuFz/nB5rB3CAMAAAAAJs7+YPwNfx4hjnqK1g/dIg5eHFe4lXF9X2sPUdHvBL5RAlXQrc/4/YKaoMwAAAAAGxu9iAc/6/6/W6s7v9te8BCPfZ2bu+OlfnvbzrKuBfud2wUTR+zd1wckuNHNLT1n0t71W68fe1IG4bL/jlZ3sfge5uPe8g991mD8NSVyMlrGr6uhfaK21Xd+2qfc2/YHg7Qq3E/fqRGKH39Qff2pvT5TL13erYwCA/ei91zXZ+X5DWM/I8O6XPO/czWH5Oem8zPdM7Pc84xAAAAABRv1iDcjFqdoSozmg2OaYeudNirj1s3ds5Vj2C5AbJ5nN4g1g6gy68tB9HV9w9fw8qc5z16zAYjYzBnEK6PyV6J3Jz3yTEw83yakTQ+nw0G4eQcDp57HConrpoenvf8e6d2xEF47c9x5s+qOV/JcYn1xwxf59i5mH69c44BAAAAgJmD8HB8TAeo/CCVG9/WDnIb2Oy+kueYG/4mhrX1jzUcTFeGtw3P6cpgVB2YGgCb28YH2NzYG3Tvc5NBeHo8PexrGT3f2xiEp0baOYPwnOcw45j8a0zPx7qfZzDnGAAAAADY2hXC7SCVKxm8Roe+jeWHxKV4ZWrS8viJQTg36q593ulomOidw/q5jY+S60bU9ecw+XmsGXYb3de+ySA8/pqDqeG7Mf+9UzviIBw0zzs+Tm78nTMIj//8ajOO6T+Pfv3XN/XzjOYcAwAAAEDpNhiEO2PTYOhqxqg5I936MXOmyQG2O25GyXOcGIRzr2Pd8547fIb7nnVfo7ePDbpjmsddPbfpQbh57dd+EJ7z3qltYRDual5D531wrQfhjf8tpD/PnDnHAAAAAFCiGYPwvMGuHv7WjIO17BC7qXWjaPOcu7c3z6/zOjLPY2qInRzv5gyEC/V9fOj++rlPnc/JQTgdJ2dIR9nBCLqQPmb/7+1AnJzT5n7WPJf6+U79rNrHmvuatjwID3526f23z7///OL5mHrOM45pH2vq3OSkP8+cOccAAAAAUJ5ZVwivRrF+6ZDVDHvTxwTpcRuPezMG2Gas7D6P0/0hNvea0gGtHewGxyWPPTkWd8X7yx07co6zw+3U0Jd7zpnHS8/P8Jj2KtO28HMMj939ec4ahIPMc0p/5tPvndUgPWjD0TP3OOlz6Z+bxeurn//wdQ7uK3Oe1x6TfY91HmvOz3PmzxwAAAAA1g/C7dg0GG3rAXN6lN2VemQ76tWPW3v+866g3or6Z3E85xwAAAAAOPkOPQg3Vz7OuDp067Y0wG5rEK7v59qch9lXIgMAAAAAZBzyl8otOunD5DFe4QwAAAAAcBzmfYYwAAAAAAAnnkEYAAAAAKAQBmEAAAAAgEIYhAEAAAAACmEQBgAAAAAohEEYAAAAAKAQBmEAAAAAgEIYhAEAAAAACmEQBgAAAAAohEEYAAAAAKAQB9Uf/1hVd99dVadOVdV3v9v05JPtzcA1Ef/txT73uebfZOy9762q17/+8HXvK/SNbzSPAwAAAEBRDqo771z858F4N9wwb1jqdulSe/dwnTtzpqoefLD/b+Kmm/r/Zrq94hX5f2fHWXhO4bm98Y3N83/22fbFAQAAAHC9OaieeKKq3vCG3Q9Vr3vdcBwLVz12h7Q5TY1taXHg6hYG6zDiwSbCSBreO/HK3fD+yr3Pt9krXzl8T99yy/A9PVV6ZXH4d5h7rG7h3w0AAAAA16WD9s+VcHVvvNK3+39bT4el1752OCSdtNIrIz/96eZ1h4/RoAzx/d69yjf8DyTxfR6ukM+9d9LSK+lDb3/76j67havy47+xbmfPtk/qGgkfDRMeNzyf8Lzi8w7nAgAAAIDr0kH753Z0x+RY+EiJdBA76uehxsYGt9yxoXDFZW7MGyt8z5vfnH+MWO4jM0JG5eMVzn/359H9Hzfi+yH3M59T+B9DwvsifPZ2uG8AAAAAOCEO2j/LEj4mIwx53Ssj5/xf6Q9bGBDjCJn+X/7D1Zjd4TJU8me4hqtk0/Px0EP9cxaL5zSWO/eb9JrXrO6r+3MKjx+eh5EfAAAAgBPuoP2TKH5WbLj6Mzc6xuZ+lMC2yn2ebO4zksc+jmDbjY20sfS5dtv0Su1tFc9hPG/xCt/w0QkAAAAAUICD9k+2Jb3CNXwucRxJw8cMxFF0l1ckX6/lfjFhesV19yM8/PJAAAAAAOg5aP9kX3TH5Fi8Wrlbd1yOhY88yA2puyz3y9Ri4Zezpc+729jnL4cAAAAAgK07aP8EAAAAAOA6ZxAGAAAAACiEQRgAAAAAoBAGYQAAAACAQhiEAQAAAAAKYRAGAAAAACiEQRgAAAAAoBAGYQAAAACAQhiEAQAAAAAKYRAGAAAAACiEQRgAAAAAoBAGYQAAAACAQhiEAQAAAAAKYRAGAAAAACiEQRgAAAAAoBAGYQAAAACAQhiEAQAAAAAKYRAGAAAAACiEQRgAAAAAoBAGYQAAAACAQhiEAQAAAAAKYRAGAAAAACiEQRgAAAAAoBAGYQAAAACAQhiEAQAAAAAKYRAGAAAAACiEQRgAAAAAoBAGYQAAAACAQhiEAQAAAAAKYRAGAAAAACiEQRgAAAAAoBAGYQAAAACAQhiEAQAAAAAKYRAGAAAAACiEQRgAAAAAoBAGYQAAAACAQhiEAQAAAAAKYRAGAAAAACiEQRgAAAAAoBAGYQAAAACAQhiEAQAAAAAKYRAGAAAAACiEQRgAAAAAoBAGYQAAAACAQhiEAQAAAAAKYRAGAAAAACiEQRgAAAAAoBAGYQAAAACAQhiEAQAAAAAKYRAGAAAAACiEQRgAAAAAoBAGYQAAAACAQhiEAQAAAAAKYRAGAAAAACiEQRgAAAAAoBAGYQAAAACAQhiEAQAAAAAKYRAGAAAAACiEQRgAAAAAoAhV9f+bh6hdm3KDJAAAAABJRU5ErkJggg==" width="1412" height="158" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-jwt-auth-test">3. JWT Auth Test<a class="hash-link" href="#3-jwt-auth-test" title="Direct link to heading">​</a></h4><p>First, we should access <strong>[GET /auth/token]</strong> api to get a JWT to use, as shown below:</p><p><img loading="lazy" alt="success" src="/sureness/zh-cn/assets/images/test5-3618d00ade7d90f24539c08ed3320bf1.PNG" width="1277" height="562" class="img_ev3q"></p><p>Then, use the JWT as Bearer Token to access REST API, as shown below:</p><p><img loading="lazy" alt="success" src="/sureness/zh-cn/assets/images/test6-05c520dab5b7dbbc0252e6bbbe9750b0.PNG" width="1287" height="561" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="test-authorization">Test Authorization<a class="hash-link" href="#test-authorization" title="Direct link to heading">​</a></h3><ul><li>success - user <strong>tom</strong> has role <strong>role3</strong>, the api <strong>[DELETE - /api/v2/host]</strong> support <strong>role3</strong> access, so <strong>tom</strong> can access api <strong>[DELETE - /api/v2/host]</strong> success, as shown below:</li></ul><p><img loading="lazy" alt="success" src="/sureness/zh-cn/assets/images/test7-ba23c5f0d743f865c1fc24ac44a7f06c.PNG" width="1288" height="564" class="img_ev3q"></p><ul><li>fail - user <strong>tom</strong> only has role <strong>role3</strong>, the api <strong>[GET - /api/v1/source1]</strong> only support <strong>role2</strong> access, not support <strong>role3</strong>,  so <strong>tom</strong> can not access api <strong>[GET - /api/v1/source1]</strong>, as shown below:</li></ul><p><img loading="lazy" alt="fail" src="/sureness/zh-cn/assets/images/test8-cd9aaab2d2d892093a58e62724a8da99.PNG" width="1283" height="557" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">​</a></h2><p>Javalin is a framework dedicated to simplicity and ease of use, and so is Sureness.<br>
<!-- -->We hope you enjoy this tutorial. Of course, the tutorial only introduces a simple introduction. Our account data, role permission data can not only be written in <code>sureness.yml</code>, but also loaded and obtained from the database and annotations. We can also customize the authentication method, data source, etc.<br>
<!-- -->Finally, thank you again for reading.</p><p><a href="https://github.com/usthe/sureness/tree/master/samples/javalin-sureness" target="_blank" rel="noopener noreferrer">DEMO SOURCE CODE ON GITHUB</a></p>]]></content>
        <author>
            <name>tom</name>
            <uri>https://github.com/tomsun28</uri>
        </author>
        <category label="integrate" term="integrate"/>
    </entry>
</feed>